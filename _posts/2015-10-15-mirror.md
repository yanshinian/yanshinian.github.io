---
layout: post
title: "åå°„â”€â”€Mirrorï¼ˆswift 2.0ï¼‰"
description: Swift2.0
date: 2015-10-15 12:45
category: Swift2.0
---

> æ³¨æ„ï¼šæœ¬äººè‹±è¯­æ°´å¹³æœ‰é™ï¼Œå¦‚æœ‰é”™è¯¯ï¼Œè¯·è¯´ä¸‹å“ˆ
> 
>æ³¨æ„ï¼šadvanceçš„ä½¿ç”¨ï¼Œåœ¨xcode 7betaç‰ˆ è·Ÿ xcode 7.0.1 ï¼ˆ7çš„æ­£å¼ç‰ˆï¼Œæˆ‘æ²¡ç”¨ï¼‰æ˜¯ä¸ä¸€æ ·çš„


###å‰å¥ï¼Œåœ¨ä½¿ç”¨`Mirror`ä¹‹å‰æˆ‘ä»¬å…ˆå»ºç«‹ä¸€ä¸ªå¯¹è±¡ï¼Œæ–¹ä¾¿æµ‹è¯•ï¼

åˆ›å»ºPerson.swiftï¼Œæ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š

```
import UIKit

class Person: NSObject {
    var name: String?
    var age: Int = 0
    
}

```
###å…¶æ¬¡ï¼Œæˆ‘ä»¬ä»‹ç»ä¸‹`Mirror`

ä»»æ„`å¯¹è±¡å®ä¾‹`çš„`å­ç»“æ„`è·Ÿ`å¯é€‰æ˜¾ç¤ºç±»å‹`çš„å±•ç°ã€‚

ä¾‹å¦‚ å­˜å‚¨å±æ€§ï¼Œé›†åˆå…ƒç´ ï¼Œå…ƒç»„æˆ–è€…æšä¸¾

####å¸¸ç”¨å±æ€§

* `subjectType`ï¼šå¯¹è±¡`ç±»å‹`

* `children`ï¼šåå°„å¯¹è±¡çš„`å±æ€§é›†åˆ`

* `displayStyle`ï¼šåå°„å¯¹è±¡å±•ç¤º`ç±»å‹`



### Mirror ä½¿ç”¨

#### åˆ›å»ºä¸€ä¸ª `Person` å¯¹è±¡ï¼Œä½¿ç”¨`Mirror` åå°„

```
let p = Person()
p.name = "å°å¼º"
p.age = 13

let mirror: Mirror = Mirror(reflecting:p)
```

####è·å–`å¯¹è±¡ç±»å‹`

```
mirror.subjectType 

print(mirror.subjectType) // æ‰“å°å‡ºï¼šPerson
```
####è·å–`å¯¹è±¡å±æ€§`ä»¥åŠ`å±æ€§çš„å€¼`

```
for p in mirror.children {
    let propertyNameString = p.label! // ä½¿ç”¨!å› ä¸ºlabel æ˜¯ optionalç±»å‹ 
    let v = p.value // è¿™ä¸ªæ˜¯å±æ€§çš„å€¼ï¼Œname æ˜¯å¯é€‰å±æ€§æ‰“å°ä¸ºOptional("å°å¼º")
13
    print(v)
    print(propertyNameString)
}
```
é™¤äº†ä¸Šé¢çš„éå†ï¼Œä½ è¿˜å¯ä»¥è¿™æ ·ï¼š

```
for (index, value) in mirror.children.enumerate() {
	index // 0
    value.label!
    value.value 
    print(value.label)
    print(value.value)
}
```
#### è·å–å±æ€§çš„`ç±»å‹`


##### è·å–`æŒ‡å®š`çš„å±æ€§`ç±»å‹`

æŒ‡å®šâ€”â€”å°±æ˜¯è¯´æˆ‘ä»¬çŸ¥é“è¿™ä¸ªç±»è‚¯å®šæœ‰å±æ€§ï¼Œè€Œä¸”è¿˜çŸ¥é“æœ‰å‡ ä¸ªï¼Œå¦åˆ™ advanceä¸­ï¼Œä½ å¡«å†™äº† 100ï¼Œæ²¡æœ‰100ä¸ªå±æ€§ï¼Œå°±å´©æºƒäº†

```
let children = mirror.children
let p0 = advance(children.startIndex, 0, children.endIndex) // name çš„ä½ç½®
let p0Mirror =  Mirror(reflecting: children[p0].value) // name çš„åå°„
print(p0Mirror.subjectType) //Optional<String> è¿™ä¸ªå°±æ˜¯name çš„ç±»å‹
```
##### è·å–`åŠ¨æ€`çš„å±æ€§`ç±»å‹`

æˆ‘å¹¶ä¸çŸ¥é“æˆ‘æœ‰å‡ ä¸ªå±æ€§ã€‚

```
for p in mirror.children {
    let propertyNameString = p.label!
    let v = p.value
    let vMirror =  Mirror(reflecting: v) // é€šè¿‡å€¼æ¥è·å– å±æ€§çš„ ç±»å‹
    print(vMirror.subjectType)
}
```
### åº”ç”¨åœºæ™¯

1. æœ‰ä¸ªæˆéƒ½çš„å°ä¼™å­å†™çš„å­—å…¸è½¬æ¨¡å‹çš„`æ¡†æ¶`â€”â€”`Reflect`ã€‚å°±ç”¨çš„è¿™ä¸ª`åå°„`å†™æˆçš„ã€‚

2. ç»™FMDBå°è£…ä¸€å±‚ï¼Ÿå¯¹å§ï¼Œè¿™æ˜¯æˆ‘è‡ªå·±æƒ³çš„ï¼Œåœ¨å†™è¿™ä¸ªç±»ã€‚`è‡ªå®šä¹‰æ¨¡å‹`ç»§æ‰¿è¿™ä¸ªç±»ä½¿ç”¨
	
	* æ¯”å¦‚ï¼šp.insert(),å°±æ˜¯Peronå¯¹è±¡pä¸­çš„å¯¹è±¡æ’å…¥åˆ°æ•°æ®åº“ï¼Œä½ å¯ä»¥åšç±»å‹æ ¡éªŒï¼Œå‡è®¾ï¼Œä½ æ’å…¥çš„æ˜¯Text è€Œæ•°æ®ç±»å‹æ˜¯ Integerï¼Œæ ¡éªŒä¹‹åï¼ŒæŠ¥ä¸ªé”™æç¤ºä¸‹ç”¨æˆ·ã€‚ï¼ˆä½ å¯ä»¥å°è£…æˆ,p.where("age>14").select(),æ³¨æ„ï¼Œswiftä¸­ä¸èƒ½ä½¿ç”¨whereè·Ÿselectåšå‡½æ•°åå­—ï¼Œå› æ­¤æˆ‘æ¢æˆäº†p.condition("age>14").find()ã€‚ğŸ˜­ï¼‰
	
	
## Swift 2.0 å­—ç¬¦ä¸²æˆªå–å¤„ç†æ–¹å¼

```
swift2.0ç¤ºä¾‹ï¼šæˆªå–æœ€åä¸€ä¸ªå­—ç¬¦
ç¯å¢ƒ 7.0 beta 6
let a = "a,b,c,"
let ad = advance(a.endIndex, -1)
print(a.substringToIndex(ad))
ç¯å¢ƒ 7.0.1 æ­£å¼ç‰ˆ
let a = "a,b,c,"
print(a.substringToIndex(a.endIndex.advancedBy(-1)))
é‚£ä¹ˆæˆªå–èŒƒå›´å‘¢ï¼Ÿ
betaå¦‚ä¸‹ï¼š
print(a.substringWithRange(Range(start: advance(a.endIndex, -2),end: advance(a.endIndex, -1))))
æ­£å¼å¦‚ä¸‹ï¼š
 print(a.substringWithRange(Range(start: a.endIndex.advancedBy(-2), end: a.endIndex.advancedBy(-1))))
 
å‚è€ƒé“¾æ¥ï¼šhttp://stackoverflow.com/questions/28182441/swift-how-to-get-substring-from-start-to-last-index-of-character
```

å‚è€ƒé“¾æ¥ï¼š

* Mirror  <http://swiftdoc.org/v2.0/type/Mirror/>
* Reflect <https://github.com/CharlinFeng/Reflect>



